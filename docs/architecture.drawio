<mxfile host="app.diagrams.net" modified="2024-12-28T00:00:00.000Z" agent="Claude" version="22.1.0" type="device">
  <diagram name="SF6 Chapter Architecture" id="sf6-arch">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Google Cloud 領域 -->
        <mxCell id="gcp-region" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="500" height="360" as="geometry" />
        </mxCell>
        <mxCell id="gcp-label" value="Google Cloud" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=16;fontColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="50" y="50" width="150" height="30" as="geometry" />
        </mxCell>
        
        <!-- Cloud Scheduler -->
        <mxCell id="scheduler" value="Cloud Scheduler&#xa;(15分毎)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#4CAF50;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="70" y="120" width="120" height="60" as="geometry" />
        </mxCell>
        
        <!-- Cloud Functions -->
        <mxCell id="functions" value="Cloud Functions&#xa;&#xa;• YouTube API で&#xa;  新動画確認&#xa;• Pub/Sub へ発行" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#4CAF50;strokeWidth=2;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="250" y="100" width="160" height="100" as="geometry" />
        </mxCell>
        
        <!-- Cloud Pub/Sub -->
        <mxCell id="pubsub" value="Cloud Pub/Sub&#xa;&#xa;• Pull サブスクリプション&#xa;• 7日間メッセージ保持" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#4CAF50;strokeWidth=2;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="250" y="240" width="180" height="80" as="geometry" />
        </mxCell>
        
        <!-- Secret Manager -->
        <mxCell id="secrets" value="Secret Manager&#xa;YouTube OAuth / Gemini API Key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#FBC02D;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="70" y="320" width="200" height="50" as="geometry" />
        </mxCell>
        
        <!-- ローカルPC 領域 -->
        <mxCell id="local-region" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#2196F3;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="580" y="40" width="380" height="360" as="geometry" />
        </mxCell>
        <mxCell id="local-label" value="ローカル PC" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=16;fontColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="590" y="50" width="150" height="30" as="geometry" />
        </mxCell>
        
        <!-- Python スクリプト -->
        <mxCell id="python" value="Python 常駐スクリプト&#xa;&#xa;1. Pub/Sub から Pull&#xa;2. yt-dlp で動画DL&#xa;3. OpenCV でフレーム抽出&#xa;4. Gemini API でキャラ認識&#xa;5. YouTube API でチャプター更新&#xa;6. R2 へ JSON アップロード&#xa;7. メッセージを Ack" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#2196F3;strokeWidth=2;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="620" y="100" width="220" height="180" as="geometry" />
        </mxCell>
        
        <!-- 外部サービス -->
        <mxCell id="youtube" value="YouTube&#xa;Data API" style="ellipse;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="860" y="100" width="80" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="gemini" value="Gemini&#xa;API" style="ellipse;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="860" y="180" width="80" height="60" as="geometry" />
        </mxCell>
        
        <!-- Cloudflare 領域 -->
        <mxCell id="cf-region" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FF9800;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="440" width="920" height="280" as="geometry" />
        </mxCell>
        <mxCell id="cf-label" value="Cloudflare" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=16;fontColor=#E65100;" vertex="1" parent="1">
          <mxGeometry x="50" y="450" width="150" height="30" as="geometry" />
        </mxCell>
        
        <!-- R2 -->
        <mxCell id="r2" value="Cloudflare R2&#xa;&#xa;/videos/*.json&#xa;/index/meta.json&#xa;/index/characters/*.json" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#FFFFFF;strokeColor=#FF9800;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="70" y="500" width="160" height="120" as="geometry" />
        </mxCell>
        
        <!-- Pages -->
        <mxCell id="pages" value="Cloudflare Pages&#xa;&#xa;• 静的サイト (HTML/JS)&#xa;• R2 から JSON 取得&#xa;• GitHub 連携デプロイ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#FF9800;strokeWidth=2;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="300" y="500" width="180" height="100" as="geometry" />
        </mxCell>
        
        <!-- Access -->
        <mxCell id="access" value="Cloudflare Access&#xa;&#xa;• Google ログイン認証&#xa;• 自分だけアクセス可能" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#FF9800;strokeWidth=2;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="550" y="500" width="180" height="100" as="geometry" />
        </mxCell>
        
        <!-- ブラウザ -->
        <mxCell id="browser" value="ブラウザ&#xa;(閲覧者)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#9C27B0;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="800" y="520" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- 矢印: Scheduler -> Functions -->
        <mxCell id="arrow1" value="トリガー" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4CAF50;strokeWidth=2;fontColor=#4CAF50;" edge="1" parent="1" source="scheduler" target="functions">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 矢印: Functions -> Pub/Sub -->
        <mxCell id="arrow2" value="発行" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4CAF50;strokeWidth=2;fontColor=#4CAF50;" edge="1" parent="1" source="functions" target="pubsub">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 矢印: Pub/Sub -> Python -->
        <mxCell id="arrow3" value="Pull" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#2196F3;strokeWidth=2;fontColor=#2196F3;" edge="1" parent="1" source="pubsub" target="python">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="500" y="280" />
              <mxPoint x="500" y="190" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- 矢印: Python -> R2 -->
        <mxCell id="arrow4" value="JSON&#xa;アップロード" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF9800;strokeWidth=2;fontColor=#FF9800;" edge="1" parent="1" source="python" target="r2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="730" y="420" />
              <mxPoint x="150" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- 矢印: Python -> YouTube -->
        <mxCell id="arrow5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#E53935;strokeWidth=2;dashed=1;" edge="1" parent="1" source="python" target="youtube">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 矢印: Python -> Gemini -->
        <mxCell id="arrow6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#E53935;strokeWidth=2;dashed=1;" edge="1" parent="1" source="python" target="gemini">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 矢印: R2 -> Pages -->
        <mxCell id="arrow7" value="fetch" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF9800;strokeWidth=2;fontColor=#FF9800;" edge="1" parent="1" source="r2" target="pages">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 矢印: Pages -> Access -->
        <mxCell id="arrow8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF9800;strokeWidth=2;" edge="1" parent="1" source="pages" target="access">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 矢印: Access -> Browser -->
        <mxCell id="arrow9" value="認証後&#xa;アクセス" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9C27B0;strokeWidth=2;fontColor=#9C27B0;" edge="1" parent="1" source="access" target="browser">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- 凡例 -->
        <mxCell id="legend" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FAFAFA;strokeColor=#9E9E9E;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="1000" y="40" width="180" height="200" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="凡例" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1000" y="50" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-gcp" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1020" y="80" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-gcp-text" value="Google Cloud" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1060" y="80" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-local" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#2196F3;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1020" y="110" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-local-text" value="ローカル PC" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1060" y="110" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-cf" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FF9800;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1020" y="140" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-cf-text" value="Cloudflare" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1060" y="140" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-ext" value="" style="ellipse;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1020" y="170" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-ext-text" value="外部 API" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1060" y="170" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-user" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#9C27B0;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1020" y="200" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-user-text" value="ユーザー" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1060" y="200" width="100" height="20" as="geometry" />
        </mxCell>
        
        <!-- タイトル -->
        <mxCell id="title" value="SF6 Chapter 自動生成システム - アーキテクチャ構成図" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=20;" vertex="1" parent="1">
          <mxGeometry x="300" y="740" width="500" height="30" as="geometry" />
        </mxCell>
        
        <!-- コスト表示 -->
        <mxCell id="cost" value="月額コスト: $0 (全サービス無料枠内)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=0;fontSize=14;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="300" y="770" width="500" height="20" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
